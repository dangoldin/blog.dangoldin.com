<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title> Visualizing Kafka partition changes - Dan Goldin </title>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=referrer content="no-referrer">
<meta name=description content="While doing some Kafka maintenance I wrote a simple way to visualize differences in partition assignments.">
<meta property="og:site_name" content="Dan Goldin">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="/2019/10/01/visualizing-kafka-partition-changes/">
<meta property="og:title" content="Visualizing Kafka partition changes">
<meta property="og:image" content="//image/kafka-partition-diff-vis.png">
<meta property="og:description" content="While doing some Kafka maintenance I wrote a simple way to visualize differences in partition assignments.">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@dangoldin">
<meta name=twitter:creator content="@dangoldin">
<meta name=twitter:title content="Visualizing Kafka partition changes">
<meta name=twitter:description content="While doing some Kafka maintenance I wrote a simple way to visualize differences in partition assignments.">
<meta name=twitter:image content="//image/kafka-partition-diff-vis.png">
<link rel=canonical href=/2019/10/01/visualizing-kafka-partition-changes/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous>
<link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css>
<link rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous>
<link rel="shortcut icon" href=/favicon.png>
<link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-36313127-1')</script>
</head>
<body>
<div class="my-4 my-lg-5 header">
<div class=container>
<div class=row>
<div class="col-auto offset-lg-2 d-none d-lg-block">
<a href=/>
<img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo>
</a>
</div>
<div class="col-auto align-self-center mr-auto">
<a href=/>
<h1 class=name>Dan Goldin</h1>
</a>
<ul class="nav nav-primary">
<li class=nav-item>
<a class="nav-link text-home" href=/>
Home
</a>
</li>
<li class=nav-item>
<a class="nav-link text-about" href=/about/>
About
</a>
</li>
<li class=nav-item>
<a class="nav-link text-lore" href=/lore/>
Lore
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class=content>
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<h1 class="mx-0 mx-md-4 blog-post-title">Visualizing Kafka partition changes</h1>
<div class="mb-md-4 meta">
<span class="date middot" title="Tue Oct 1 2019 00:00:00 UTC">
2019-10-01
</span>
<span class="reading-time middot">
2 min read
</span>
<div class="d-none d-md-inline tags">
<ul class="list-unstyled d-inline">
<li class="d-inline middot">
<a href=/tags/code>code</a>
</li>
<li class="d-inline middot">
<a href=/tags/devops>devops</a>
</li>
</ul>
</div>
<div class="d-none d-md-inline tags">
<ul class="list-unstyled d-inline">
</ul>
</div>
</div>
<div class="markdown blog-post-content">
<p>Earlier this week we scaled up our Kafka cluster to take advantage of more availability zones and increase the replication for some of our key topics. After making sure the new brokers joined the existing cluster we needed to redo the partitioning to take advantage of these newly available brokers.</p>
<p>I&rsquo;m sure there are better and more modern tools out there but we&rsquo;ve been using <a href=https://github.com/SiftScience/kafka-assigner>SiftScience&rsquo;s kafka-assigner</a>. Rather than being a naive partitioning it looks at the existing assignments and optimizes the new assignment to minimize the number of moves while striving to keep the partitions evenly distributed across all brokers.</p>
<p>The script is simple to run - you give it the topic and the desired replication factor and it generates the new partition assignments via JSON that can then be passed into Kafka&rsquo;s built in <a href=https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools#Replicationtools-4.ReassignPartitionsTool>partition reassignment tool</a>.</p>
<p>As part of our testing we wanted to verify that the new assignments made sense by quickly looking at the differences but the task was made difficult since the original assignment was printed in a random order. This made a standard diff difficult to do so I ended up building a small tool to sort the JSON and then visualize the differences.</p>
<p>The code is up on <a href=https://github.com/dangoldin/js-tools>GitHub</a> and the tool is available at <a href=https://dangoldin.github.io/js-tools/#tab-kafka-partition-diff>https://dangoldin.github.io/js-tools/#tab-kafka-partition-diff</a>. It&rsquo;s not the fanciest but is a simple solution to a simple problem. I wish the tool itself did a better job of highlighting the differences but that&rsquo;s another project.</p>
<img src=/image/kafka-partition-diff-vis.png alt="Kafka partition difference visualizer" data-width=1224 data-height=749 data-layout=responsive>
</div>
<div class=navigation>
<div class=row>
<div class="col-12 col-lg-6">
<div class="mx-0 mx-md-4 mt-4 text-left">
<a href=/2019/09/28/sso-and-saas-pricing/>« SSO and SAAS pricing</a>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="mx-0 mx-md-4 mt-4 text-right">
<a href=/2019/10/03/upgrading-pip-packages-within-a-dockerfile/>Upgrading pip packages within a Dockerfile »</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id=comments>
<div class="py-3 content">
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<div class=comments>
<script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</div>
</div>
</section>
<div class="my-4 footer">
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<hr>
</div>
</div>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-2">
<div class="mx-0 mx-md-4 site-copyright">
© 2021 Dan Goldin
</div>
</div>
<div class="col-sm-12 col-lg-6">
<div class="mx-0 mx-md-4 site-social">
<ul>
<li><a href=mailto:dan@dangoldin.com>Contact</a></li>
<li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li>
<li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li>
<li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li>
<li><a href=/index.xml class=mr-0>RSS</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script>
<script>window.addEventListener('load',function(){hljs.initHighlighting()},!0)</script>
</body>
</html>