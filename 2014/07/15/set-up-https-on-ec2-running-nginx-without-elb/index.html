<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Set up HTTPS on EC2 running Nginx without ELB - Dan Goldin</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="A quick guide on how to set up HTTPS on an EC2 instance that's running Nginx without having to upload the SSL certificate to an ELB"><meta property="og:site_name" content="Dan Goldin"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="/2014/07/15/set-up-https-on-ec2-running-nginx-without-elb/"><meta property="og:title" content="Set up HTTPS on EC2 running Nginx without ELB"><meta property="og:image" content="/image/photo.jpg"><meta property="og:description" content="A quick guide on how to set up HTTPS on an EC2 instance that's running Nginx without having to upload the SSL certificate to an ELB"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dangoldin"><meta name=twitter:creator content="@dangoldin"><meta name=twitter:title content="Set up HTTPS on EC2 running Nginx without ELB"><meta name=twitter:description content="A quick guide on how to set up HTTPS on an EC2 instance that's running Nginx without having to upload the SSL certificate to an ELB"><meta name=twitter:image content="/image/photo.jpg"><link rel=canonical href=/2014/07/15/set-up-https-on-ec2-running-nginx-without-elb/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=image/favicon.png><link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-36313127-1');</script></head><body><div class="my-4 my-lg-5 header"><div class=container><div class=row><div class="col-auto offset-lg-2 d-none d-lg-block"><a href=/><img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo></a></div><div class="col-auto align-self-center mr-auto"><a href=/><h1 class=name>Dan Goldin</h1></a><ul class="nav nav-primary"><li class=nav-item><a class="nav-link text-home" href=/>Home</a></li><li class=nav-item><a class="nav-link text-about" href=/about/>About</a></li><li class=nav-item><a class="nav-link text-lore" href=/lore/>Lore</a></li></ul></div></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">Set up HTTPS on EC2 running Nginx without ELB</h1><div class="mb-md-4 meta"><span class="date middot" title="Tue Jul 15 2014 00:00:00 UTC">2014-07-15</span>
<span class="reading-time middot">2 min read</span><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class="d-inline middot"><a href=/tags/code>code</a></li><li class="d-inline middot"><a href=/tags/devops>devops</a></li></ul></div><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"></ul></div></div><div class="markdown blog-post-content"><p>I recently needed to set up HTTPS for my side project, <a href=https://better404.com/ target=_blank>better404.com</a>. Amazon makes it easy to <a href=http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/US_UpdatingLoadBalancerSSL.html target=_blank>set up</a> by uploading it directly to an ELB but in my case it’s hosted on a single AWS instance so I didn’t want to pay for an ELB that would be more expensive than my one instance. I’ve heard horror stories and expected the worst but it turned out surprisingly easy. Hopefully these steps can help someone else out.</p><ul><li>Get an HTTPS certificate. I bought three certificates from Namecheap a couple of months ago when they were running a promotion.</li><li>Go through the certificate generation process. I found <a href=http://kbeezie.com/free-ssl-with-nginx/ target=_blank>this guide</a> that explains how to do it detail and worked well for me. The only things I had to change where the Nginx certificate configuration folder path (/opt/local/nginx/conf/certs => /etc/nginx/certs/) and replacing the filenames to be more specific (domain.* to better404.*). Note that this process is not immediate and you will need to send the contents of your CSR file to the SSL provider and they will respond back with the SSL certificate to use.</li><li>Enable SSL in Nginx. The previous guide provides some information here and I’m including the relevant parts from my configuration. I chose to redirect all traffic to HTTPS rather than supporting both simultaneously.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#75715e>#Nginx config
</span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#e6db74>*:80</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>www.better404.com</span>;
    <span style=color:#f92672>rewrite</span>        <span style=color:#e6db74>^</span> <span style=color:#e6db74>https://</span>$server_name$request_uri? <span style=color:#e6db74>permanent</span>;
}

<span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#e6db74>*:80</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>better404.com</span>;
    <span style=color:#f92672>rewrite</span>        <span style=color:#e6db74>^</span> <span style=color:#e6db74>https://</span>$server_name$request_uri? <span style=color:#e6db74>permanent</span>;
}

<span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#e6db74>*:443</span> <span style=color:#e6db74>ssl</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>better404.com</span>;

    <span style=color:#f92672>ssl</span> <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>certs/better</span><span style=color:#ae81ff>404</span><span style=color:#e6db74>.pem</span>;
    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>certs/better</span><span style=color:#ae81ff>404</span><span style=color:#e6db74>.key</span>;<span style=color:#f92672>{%</span> <span style=color:#e6db74>endhighlight</span> <span style=color:#e6db74>nginx</span> <span style=color:#e6db74>%</span><span style=color:#960050;background-color:#1e0010>}</span><span style=color:#e6db74>&lt;/li&gt;</span>
  <span style=color:#e6db74>&lt;li&gt;Allow</span> <span style=color:#e6db74>Nginx</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>bind</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>the</span> <span style=color:#e6db74>IP</span> <span style=color:#e6db74>address.</span> <span style=color:#e6db74>One</span> <span style=color:#e6db74>thing</span> <span style=color:#e6db74>that’s</span> <span style=color:#e6db74>not</span> <span style=color:#e6db74>mentioned</span> <span style=color:#e6db74>in</span> <span style=color:#e6db74>the</span> <span style=color:#e6db74>guide</span> <span style=color:#e6db74>and</span> <span style=color:#e6db74>required</span> <span style=color:#e6db74>a</span> <span style=color:#e6db74>bit</span> <span style=color:#e6db74>of</span> <span style=color:#e6db74>digging</span> <span style=color:#e6db74>around</span> <span style=color:#e6db74>is</span> <span style=color:#e6db74>that</span> <span style=color:#e6db74>you</span> <span style=color:#e6db74>need</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>allow</span> <span style=color:#e6db74>Nginx</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>bind</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>the</span> <span style=color:#e6db74>non</span> <span style=color:#e6db74>local</span> <span style=color:#e6db74>IP</span> <span style=color:#e6db74>address</span> <span style=color:#e6db74>-</span> <span style=color:#e6db74>otherwise</span> <span style=color:#e6db74>it</span> <span style=color:#e6db74>can</span> <span style=color:#66d9ef>on</span><span style=color:#e6db74>ly</span> <span style=color:#e6db74>access</span> <span style=color:#e6db74>the</span> <span style=color:#e6db74>private</span> <span style=color:#e6db74>IP</span> <span style=color:#e6db74>address</span> <span style=color:#e6db74>set</span> <span style=color:#e6db74>by</span> <span style=color:#e6db74>AWS.</span> <span style=color:#e6db74>There’s</span> <span style=color:#e6db74>a</span> <span style=color:#e6db74>&lt;a</span> <span style=color:#e6db74>href=&#34;http://stackoverflow.com/a/13141104/1139968&#34;</span> <span style=color:#e6db74>target=&#34;_blank&#34;&gt;quick</span> <span style=color:#e6db74>guide&lt;/a&gt;</span> <span style=color:#66d9ef>on</span> <span style=color:#e6db74>how</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>do</span> <span style=color:#e6db74>this</span> <span style=color:#e6db74>I</span> <span style=color:#e6db74>found</span> <span style=color:#66d9ef>on</span> <span style=color:#e6db74>StackOverflow.&lt;/li&gt;</span>
<span style=color:#e6db74>&lt;/ul&gt;</span>

<span style=color:#e6db74>If</span> <span style=color:#e6db74>you</span> <span style=color:#e6db74>have</span> <span style=color:#e6db74>any</span> <span style=color:#e6db74>questions</span> <span style=color:#e6db74>feel</span> <span style=color:#e6db74>free</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>leave</span> <span style=color:#e6db74>a</span> <span style=color:#e6db74>comment</span> <span style=color:#e6db74>and</span> <span style=color:#e6db74>I’ll</span> <span style=color:#e6db74>try</span> <span style=color:#e6db74>to</span> <span style=color:#e6db74>help</span> <span style=color:#e6db74>out.</span></code></pre></div></div><div class=navigation><div class=row><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-left"><a href=/2014/07/14/getting-low-level-with-http/>« Getting low level with HTTP</a></div></div><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-right"><a href=/2014/07/16/a-simple-way-to-automate-aws-deployments/>A simple way to automate AWS deployments »</a></div></div></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><div class="my-4 footer"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><hr></div></div><div class="row justify-content-center"><div class="col-sm-12 col-lg-2"><div class="mx-0 mx-md-4 site-copyright">© 2021 Dan Goldin</div></div><div class="col-sm-12 col-lg-6"><div class="mx-0 mx-md-4 site-social"><ul><li><a href=mailto:dan@dangoldin.com>Contact</a></li><li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li><li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li><li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li><li><a href=/index.xml class=mr-0>RSS</a></li></ul></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script>window.addEventListener('load',function(){hljs.initHighlighting();},true);</script><script src=/js/math-code.js></script><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>