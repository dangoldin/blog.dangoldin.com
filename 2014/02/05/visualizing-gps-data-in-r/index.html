<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title> Visualizing GPS data in R - Dan Goldin </title>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=referrer content="no-referrer">
<meta name=description content="I found Nathan Yau's R script that plots GPS data and made a few changes to it to add a map overlay and the ability to focus in on a particular area.">
<meta property="og:site_name" content="Dan Goldin">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="/2014/02/05/visualizing-gps-data-in-r/">
<meta property="og:title" content="Visualizing GPS data in R">
<meta property="og:image" content="//image/rk-world-map.png">
<meta property="og:description" content="I found Nathan Yau's R script that plots GPS data and made a few changes to it to add a map overlay and the ability to focus in on a particular area.">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@dangoldin">
<meta name=twitter:creator content="@dangoldin">
<meta name=twitter:title content="Visualizing GPS data in R">
<meta name=twitter:description content="I found Nathan Yau's R script that plots GPS data and made a few changes to it to add a map overlay and the ability to focus in on a particular area.">
<meta name=twitter:image content="//image/rk-world-map.png">
<link rel=canonical href=/2014/02/05/visualizing-gps-data-in-r/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous>
<link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css>
<link rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous>
<link rel="shortcut icon" href=/favicon.png>
<link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-36313127-1')</script>
</head>
<body>
<div class="my-4 my-lg-5 header">
<div class=container>
<div class=row>
<div class="col-auto offset-lg-2 d-none d-lg-block">
<a href=/>
<img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo>
</a>
</div>
<div class="col-auto align-self-center mr-auto">
<a href=/>
<h1 class=name>Dan Goldin</h1>
</a>
<ul class="nav nav-primary">
<li class=nav-item>
<a class="nav-link text-home" href=/>
Home
</a>
</li>
<li class=nav-item>
<a class="nav-link text-about" href=/about/>
About
</a>
</li>
<li class=nav-item>
<a class="nav-link text-lore" href=/lore/>
Lore
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class=content>
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<h1 class="mx-0 mx-md-4 blog-post-title">Visualizing GPS data in R</h1>
<div class="mb-md-4 meta">
<span class="date middot" title="Wed Feb 5 2014 00:00:00 UTC">
2014-02-05
</span>
<span class="reading-time middot">
2 min read
</span>
<div class="d-none d-md-inline tags">
<ul class="list-unstyled d-inline">
<li class="d-inline middot">
<a href=/tags/dataviz>dataviz</a>
</li>
<li class="d-inline middot">
<a href=/tags/code>code</a>
</li>
<li class="d-inline middot">
<a href=/tags/r>R</a>
</li>
</ul>
</div>
<div class="d-none d-md-inline tags">
<ul class="list-unstyled d-inline">
</ul>
</div>
</div>
<div class="markdown blog-post-content">
<p>Earlier today I read Nathan Yau’s <a href=http://flowingdata.com/2014/02/05/where-people-run/ target=_blank>post</a> that had a quick <a href=http://projects.flowingdata.com/tut/map-routes.R target=_blank>R script</a> to plot GPX file data onto a map. I was able to quickly load up my RunKeeper data from 2013 and came up with a pretty cool visualization of each of my outdoor runs. Since my runs occurred across multiple cities and continents the visualization turned out to be very sparse without a great sense of where the runs were. I made a two quick changes to the script to make it more useful for my data: a map overlay to see where in the world I ran and an ability to view a zoomed in area of the map. I’ve included the updated script and the resulting plots below.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=color:#75715e># From Nathan&#39;s script</span>
<span style=color:#a6e22e>library</span>(plotKML)
<span style=color:#a6e22e>library</span>(ggplot2)
<span style=color:#a6e22e>library</span>(maps)

<span style=color:#75715e># GPX files downloaded from Runkeeper</span>
files <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>dir</span>(pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;\\.gpx&#34;</span>)

<span style=color:#75715e># Consolidate routes in one drata frame</span>
index <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>()
lat <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>()
long <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>()
<span style=color:#a6e22e>for </span>(i in <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#a6e22e>length</span>(files)) {

  route <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>readGPX</span>(files[i])
  location <span style=color:#f92672>&lt;-</span> route<span style=color:#f92672>$</span>tracks[[1]][[1]]

  index <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>(index, <span style=color:#a6e22e>rep</span>(i, <span style=color:#a6e22e>dim</span>(location)[1]))
  lat <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>(lat, location<span style=color:#f92672>$</span>lat)
  long <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>c</span>(long, location<span style=color:#f92672>$</span>lon)
}
routes <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>data.frame</span>(<span style=color:#a6e22e>cbind</span>(index, lat, long))

<span style=color:#75715e># Map the routes</span>
ids <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>unique</span>(index)
<span style=color:#a6e22e>plot</span>(routes<span style=color:#f92672>$</span>long, routes<span style=color:#f92672>$</span>lat, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;n&#34;</span>, axes<span style=color:#f92672>=</span><span style=color:#66d9ef>FALSE</span>, xlab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, ylab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, main<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, asp<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
<span style=color:#a6e22e>for </span>(i in <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#a6e22e>length</span>(ids)) {
  currRoute <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>subset</span>(routes, index<span style=color:#f92672>==</span>ids[i])
  <span style=color:#a6e22e>lines</span>(currRoute<span style=color:#f92672>$</span>long, currRoute<span style=color:#f92672>$</span>lat, col<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#FF000020&#34;</span>)
}

<span style=color:#75715e># Add the world map overlay</span>
world <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>map_data</span>(<span style=color:#e6db74>&#39;world&#39;</span>)
<span style=color:#a6e22e>plot</span>(world<span style=color:#f92672>$</span>long, world<span style=color:#f92672>$</span>lat, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;n&#34;</span>, axes<span style=color:#f92672>=</span><span style=color:#66d9ef>FALSE</span>, xlab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, ylab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, main<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, asp<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)

world_groups <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>unique</span>(world<span style=color:#f92672>$</span>group)
<span style=color:#a6e22e>for </span>(i in <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#a6e22e>length</span>(world_groups)) {
  currRoute <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>subset</span>(world, group<span style=color:#f92672>==</span>world_groups[i])
  <span style=color:#a6e22e>lines</span>(currRoute<span style=color:#f92672>$</span>long, currRoute<span style=color:#f92672>$</span>lat, col<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#00000020&#34;</span>)
}

route_groups <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>unique</span>(routes<span style=color:#f92672>$</span>index)
<span style=color:#a6e22e>for </span>(i in <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#a6e22e>length</span>(route_groups)) {
  currRoute <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>subset</span>(routes, index<span style=color:#f92672>==</span>route_groups[i])
  <span style=color:#a6e22e>lines</span>(currRoute<span style=color:#f92672>$</span>long, currRoute<span style=color:#f92672>$</span>lat, col<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#FF000020&#34;</span>)
}

<span style=color:#75715e># Zoom into a particular area of routes</span>
zoom <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>function</span>(routes, lat, long, radius) {
  lat_north <span style=color:#f92672>&lt;-</span> lat <span style=color:#f92672>+</span> radius
  long_west <span style=color:#f92672>&lt;-</span> long <span style=color:#f92672>-</span> radius
  lat_south <span style=color:#f92672>&lt;-</span> lat <span style=color:#f92672>-</span> radius
  long_east <span style=color:#f92672>&lt;-</span> long <span style=color:#f92672>+</span> radius
  routes.filtered <span style=color:#f92672>&lt;-</span> routes[routes<span style=color:#f92672>$</span>lat <span style=color:#f92672>&lt;</span> lat_north <span style=color:#f92672>&amp;</span> routes<span style=color:#f92672>$</span>lat <span style=color:#f92672>&gt;</span> lat_south <span style=color:#f92672>&amp;</span> routes<span style=color:#f92672>$</span>long <span style=color:#f92672>&gt;</span> long_west <span style=color:#f92672>&amp;</span> routes<span style=color:#f92672>$</span>long <span style=color:#f92672>&lt;</span> long_east, ]

  <span style=color:#a6e22e>plot</span>(routes.filtered<span style=color:#f92672>$</span>long, routes.filtered<span style=color:#f92672>$</span>lat, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;n&#34;</span>, axes<span style=color:#f92672>=</span><span style=color:#66d9ef>FALSE</span>, xlab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, ylab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, main<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>, asp<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
  route_groups <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>unique</span>(routes.filtered<span style=color:#f92672>$</span>index)
  <span style=color:#a6e22e>for </span>(i in <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#a6e22e>length</span>(route_groups)) {
    currRoute <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>subset</span>(routes.filtered, index<span style=color:#f92672>==</span>route_groups[i])
    <span style=color:#a6e22e>lines</span>(currRoute<span style=color:#f92672>$</span>long, currRoute<span style=color:#f92672>$</span>lat, col<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#FF000020&#34;</span>)
  }
}

hoboken_lat <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>40.79</span>
hoboken_long <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>-74.0279</span>
radius <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>0.25</span>

<span style=color:#a6e22e>zoom</span>(routes, hoboken_lat, hoboken_long, radius)</code></pre></div>
<ul class=thumbnails>
<li>
<div class=thumbnail>
<a href="{{ IMG_PATH }}rk-world-map.png">
<img src=/image/rk-hoboken-nyc.png alt="Zoom in on Hoboken/NYC runs" data-width=681 data-height=687 data-layout=responsive>
</a>
<p>
A few specks here and there - clearly visible runs in the NY/NJ area as well as some in Virginia, New Orleans, and San Francisco. Can also see a few runs in India.
</p>
</div>
</li>
<li>
<div class=thumbnail>
<a href="{{ IMG_PATH }}rk-hoboken-nyc.png">
<img src=/image/rk-hoboken-nyc.png alt="Zoom in on Hoboken/NYC runs" data-width=681 data-height=687 data-layout=responsive>
</a>
<p>
Zoom in on my runs in the Hoboken/NYC area. I don't have the lat/long coordinates here but if I had them it would be pretty easy to generate a map overlay.
</p>
</div>
</li>
</ul>
</div>
<div class=navigation>
<div class=row>
<div class="col-12 col-lg-6">
<div class="mx-0 mx-md-4 mt-4 text-left">
<a href=/2014/02/02/why-i-manage-my-own-blog/>« Why I manage my own blog</a>
</div>
</div>
<div class="col-12 col-lg-6">
<div class="mx-0 mx-md-4 mt-4 text-right">
<a href=/2014/02/09/travel-more/>Travel more »</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id=comments>
<div class="py-3 content">
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<div class=comments>
<script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</div>
</div>
</section>
<div class="my-4 footer">
<div class=container>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-8">
<hr>
</div>
</div>
<div class="row justify-content-center">
<div class="col-sm-12 col-lg-2">
<div class="mx-0 mx-md-4 site-copyright">
© 2021 Dan Goldin
</div>
</div>
<div class="col-sm-12 col-lg-6">
<div class="mx-0 mx-md-4 site-social">
<ul>
<li><a href=mailto:dan@dangoldin.com>Contact</a></li>
<li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li>
<li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li>
<li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li>
<li><a href=/index.xml class=mr-0>RSS</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script>
<script>window.addEventListener('load',function(){hljs.initHighlighting()},!0)</script>
<script src=/js/math-code.js></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>