<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>ALB and ELB access log schemas for Redshift - Dan Goldin
</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="It's very handy being able to analyze ELB access logs in Redshift but unfortunately it's not clear what the schema should be. The post shares the schema necessary to load the access log data."><meta property="og:site_name" content="Dan Goldin"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="/2018/06/05/alb-and-elb-access-log-schemas-for-redshift/"><meta property="og:title" content="ALB and ELB access log schemas for Redshift"><meta property="og:image" content="/image/photo.jpg"><meta property="og:description" content="It's very handy being able to analyze ELB access logs in Redshift but unfortunately it's not clear what the schema should be. The post shares the schema necessary to load the access log data."><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dangoldin"><meta name=twitter:creator content="@dangoldin"><meta name=twitter:title content="ALB and ELB access log schemas for Redshift"><meta name=twitter:description content="It's very handy being able to analyze ELB access logs in Redshift but unfortunately it's not clear what the schema should be. The post shares the schema necessary to load the access log data."><meta name=twitter:image content="/image/photo.jpg"><link rel=canonical href=/2018/06/05/alb-and-elb-access-log-schemas-for-redshift/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-36313127-1")</script></head><body><div class="my-4 my-lg-5 header"><div class=container><div class=row><div class="col-auto offset-lg-2 d-none d-lg-block"><a href=/><img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo></a></div><div class="col-auto align-self-center mr-auto"><a href=/><h1 class=name>Dan Goldin</h1></a><ul class="nav nav-primary"><li class=nav-item><a class="nav-link text-home" href=/>Home</a></li><li class=nav-item><a class="nav-link text-about" href=/about/>About</a></li><li class=nav-item><a class="nav-link text-lore" href=/lore/>Lore</a></li></ul></div></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">ALB and ELB access log schemas for Redshift</h1><div class="mb-md-4 meta"><span class="date middot" title='Tue Jun 5 2018 00:00:00 UTC'>2018-06-05
</span><span class="reading-time middot">1 min read</span><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class="d-inline middot"><a href=/tags/code>code</a></li></ul></div><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"></ul></div></div><div class="markdown blog-post-content"><p>Back in February I <a href=/2018/02/20/analyzing-aws-elb-logs/>wrote</a> about using Redshift to quickly analyze ELB access logs. This worked great until we switched from using ELBs to using ALBs. Unsurprisingly in hindsight but frustrating at the time the ALBs have a different log schema. Both the <a href=https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/access-log-collection.html>Classic</a> and <a href=https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html>Application</a> Load Balancer logs are well documented on the AWS site but unfortunately the code to create the appropriate Redshift schema is not. In the hope of helping others and passing it forward I wanted to share the Redshift schemas for both types of access logs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- ELB Logs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> elb_logs (
</span></span><span style=display:flex><span>	requesttime <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span>	elbname varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span>	requestip_port varchar(<span style=color:#ae81ff>22</span>),
</span></span><span style=display:flex><span>	backendip_port varchar(<span style=color:#ae81ff>22</span>),
</span></span><span style=display:flex><span>	requestprocessingtime double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span>	backendprocessingtime double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span>	clientresponsetime double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span>	elbresponsecode varchar(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>	backendresponsecode varchar(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>	receivedbytes bigint,
</span></span><span style=display:flex><span>	sentbytes bigint,
</span></span><span style=display:flex><span>	httprequest varchar(<span style=color:#ae81ff>5083</span>),
</span></span><span style=display:flex><span>	useragent varchar(<span style=color:#ae81ff>500</span>),
</span></span><span style=display:flex><span>	ssl_cipher varchar(<span style=color:#ae81ff>40</span>),
</span></span><span style=display:flex><span>	ssl_protocol varchar(<span style=color:#ae81ff>40</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>sortkey(requesttime);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ALB Logs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> alb_logs (
</span></span><span style=display:flex><span> <span style=color:#66d9ef>type</span> varchar(<span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span> requesttime <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span> elb varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> client_and_port varchar(<span style=color:#ae81ff>24</span>),
</span></span><span style=display:flex><span> target_and_port varchar(<span style=color:#ae81ff>24</span>),
</span></span><span style=display:flex><span> request_processing_time double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span> target_processing_time double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span> response_processing_time double <span style=color:#66d9ef>precision</span> encode bytedict,
</span></span><span style=display:flex><span> elb_status_code varchar(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span> target_status_code varchar(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span> received_bytes bigint,
</span></span><span style=display:flex><span> sent_bytes bigint,
</span></span><span style=display:flex><span> request varchar(<span style=color:#ae81ff>5000</span>),
</span></span><span style=display:flex><span> user_agent varchar(<span style=color:#ae81ff>500</span>),
</span></span><span style=display:flex><span> ssl_cipher varchar(<span style=color:#ae81ff>500</span>),
</span></span><span style=display:flex><span> ssl_protocol varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> target_group_arn varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> trace_id varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> domain_name varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> chosen_cert_arn varchar(<span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span> matched_rule_priority varchar(<span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span> request_creation_time <span style=color:#66d9ef>timestamp</span>,
</span></span><span style=display:flex><span> actions_executed varchar(<span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span> ) sortkey(requesttime);
</span></span><span style=display:flex><span> </span></span></code></pre></div></div><div class=navigation><div class=row><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-left"><a href=/2018/06/01/type-1-and-type-2-tech-specs/>« Type 1 and Type 2 tech specs</a></div></div><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-right"><a href=/2018/06/28/using-personal-aws-credentials-in-production/>Using personal AWS credentials in production »</a></div></div></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><div class="my-4 footer"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><hr></div></div><div class="row justify-content-center"><div class="col-sm-12 col-lg-2"><div class="mx-0 mx-md-4 site-copyright">© 2024 Dan Goldin</div></div><div class="col-sm-12 col-lg-6"><div class="mx-0 mx-md-4 site-social"><ul><li><a href=mailto:dan@dangoldin.com>Contact</a></li><li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li><li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li><li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li></ul></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script>window.addEventListener("load",function(){hljs.initHighlighting()},!0)</script></body></html>