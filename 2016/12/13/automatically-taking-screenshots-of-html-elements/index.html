<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Automatically taking screenshots of HTML elements - Dan Goldin</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="A simple script to capture of a screenshot of an HTML element that can exist anywhere on the page."><meta property="og:site_name" content="Dan Goldin"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="/2016/12/13/automatically-taking-screenshots-of-html-elements/"><meta property="og:title" content="Automatically taking screenshots of HTML elements"><meta property="og:image" content="/image/photo.jpg"><meta property="og:description" content="A simple script to capture of a screenshot of an HTML element that can exist anywhere on the page."><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dangoldin"><meta name=twitter:creator content="@dangoldin"><meta name=twitter:title content="Automatically taking screenshots of HTML elements"><meta name=twitter:description content="A simple script to capture of a screenshot of an HTML element that can exist anywhere on the page."><meta name=twitter:image content="/image/photo.jpg"><link rel=canonical href=/2016/12/13/automatically-taking-screenshots-of-html-elements/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicon.png><link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-36313127-1');</script></head><body><div class="my-4 my-lg-5 header"><div class=container><div class=row><div class="col-auto offset-lg-2 d-none d-lg-block"><a href=/><img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo></a></div><div class="col-auto align-self-center mr-auto"><a href=/><h1 class=name>Dan Goldin</h1></a><ul class="nav nav-primary"><li class=nav-item><a class="nav-link text-home" href=/>Home</a></li><li class=nav-item><a class="nav-link text-about" href=/about/>About</a></li><li class=nav-item><a class="nav-link text-lore" href=/lore/>Lore</a></li></ul></div></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">Automatically taking screenshots of HTML elements</h1><div class="mb-md-4 meta"><span class="date middot" title="Tue Dec 13 2016 00:00:00 UTC">2016-12-13</span>
<span class="reading-time middot">2 min read</span><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class="d-inline middot"><a href=/tags/code>code</a></li></ul></div><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"></ul></div></div><div class="markdown blog-post-content"><p>I’ve worked on a variety of scraping projects that required spinning up a browser (via selenium) and having it browse a variety of pages unattended in order to capture some data. The two most recents ones <a href=https://github.com/dangoldin/turo-automation>scraping my account data</a> from Turo and the <a href=https://github.com/dangoldin/yahoo-ffl>fantasy football stats</a> from Yahoo. These were relatively straightforward since the browser was used purely to navigate from page to page with the actual data capture done by parsing the underlying HTML.</p><p>Recently I needed to expand this approach to get screenshots of specific HTML elements on page. Taking a generic screenshot was easy since selenium comes with a built in function but expanding this to handle elements that were out of view and needed to be cropped took a bit of research. I found two StackOverflow responses that made this simple: the <a href=http://stackoverflow.com/questions/37882208/get-element-location-relative-to-viewport-with-selenium-python>first</a> explains how to scroll to a specific HTML element and the <a href=http://stackoverflow.com/questions/15018372/how-to-take-partial-screenshot-with-selenium-webdriver-in-python>other</a> explains how to screenshot an element. Putting these together was extremely painless with the resulting code below. The only nuance was incorporating the scroll amount into the crop in order to get the math to work out.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>OUT_DIR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;out&#39;</span>

fn <span style=color:#f92672>=</span> str(uuid<span style=color:#f92672>.</span>uuid4())

filename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;screenshot-&#39;</span> <span style=color:#f92672>+</span> fn <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;.jpg&#39;</span>
filepath <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUT_DIR, filename)

self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>execute_script(<span style=color:#e6db74>&#34;return arguments[0].scrollIntoView();&#34;</span>, el)
self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>execute_script(<span style=color:#e6db74>&#34;window.scrollBy(0, -150);&#34;</span>)
self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>save_screenshot(filepath)

scroll <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>execute_script(<span style=color:#e6db74>&#34;return window.scrollY;&#34;</span>)
location <span style=color:#f92672>=</span> el<span style=color:#f92672>.</span>location
size <span style=color:#f92672>=</span> el<span style=color:#f92672>.</span>size

<span style=color:#66d9ef>if</span> size[<span style=color:#e6db74>&#39;height&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>or</span> size[<span style=color:#e6db74>&#39;width&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
    <span style=color:#66d9ef>continue</span>

im <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>open(filepath)

left <span style=color:#f92672>=</span> location[<span style=color:#e6db74>&#39;x&#39;</span>]
top <span style=color:#f92672>=</span> location[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>-</span> scroll
right <span style=color:#f92672>=</span> location[<span style=color:#e6db74>&#39;x&#39;</span>] <span style=color:#f92672>+</span> size[<span style=color:#e6db74>&#39;width&#39;</span>]
bottom <span style=color:#f92672>=</span> location[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>+</span> size[<span style=color:#e6db74>&#39;height&#39;</span>] <span style=color:#f92672>-</span> scroll

im <span style=color:#f92672>=</span> im<span style=color:#f92672>.</span>crop((left, top, right, bottom))
im<span style=color:#f92672>.</span>save(filepath<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;.jpg&#39;</span>, <span style=color:#e6db74>&#39;-2.jpg&#39;</span>))</code></pre></div></div><div class=navigation><div class=row><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-left"><a href=/2016/12/10/word-clouds-and-text-similarity/>« Word clouds and text similarity</a></div></div><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-right"><a href=/2016/12/17/programming-languages-and-developer-tools/>Programming languages and developer tools »</a></div></div></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><div class="my-4 footer"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><hr></div></div><div class="row justify-content-center"><div class="col-sm-12 col-lg-2"><div class="mx-0 mx-md-4 site-copyright">© 2021 Dan Goldin</div></div><div class="col-sm-12 col-lg-6"><div class="mx-0 mx-md-4 site-social"><ul><li><a href=mailto:dan@dangoldin.com>Contact</a></li><li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li><li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li><li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li><li><a href=/index.xml class=mr-0>RSS</a></li></ul></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script>window.addEventListener('load',function(){hljs.initHighlighting();},true);</script></body></html>