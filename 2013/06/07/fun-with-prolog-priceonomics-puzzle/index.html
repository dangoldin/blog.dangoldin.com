<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Fun with Prolog: Priceonomics Puzzle - Dan Goldin</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="I attempt to solve the Priceonomics Puzzle using Prolog."><meta property="og:site_name" content="Dan Goldin"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="/2013/06/07/fun-with-prolog-priceonomics-puzzle/"><meta property="og:title" content="Fun with Prolog: Priceonomics Puzzle"><meta property="og:image" content="/image/photo.jpg"><meta property="og:description" content="I attempt to solve the Priceonomics Puzzle using Prolog."><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dangoldin"><meta name=twitter:creator content="@dangoldin"><meta name=twitter:title content="Fun with Prolog: Priceonomics Puzzle"><meta name=twitter:description content="I attempt to solve the Priceonomics Puzzle using Prolog."><meta name=twitter:image content="/image/photo.jpg"><link rel=canonical href=/2013/06/07/fun-with-prolog-priceonomics-puzzle/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=image/favicon.png><link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin"></head><body><div class="my-4 my-lg-5 header"><div class=container><div class=row><div class="col-auto offset-lg-2 d-none d-lg-block"><a href=/><img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo></a></div><div class="col-auto align-self-center mr-auto"><a href=/><h1 class=name>Dan Goldin</h1></a><ul class="nav nav-primary"><li class=nav-item><a class="nav-link text-home" href=/>Home</a></li><li class=nav-item><a class="nav-link text-about" href=/about/>About</a></li><li class=nav-item><a class="nav-link text-lore" href=/lore/>Lore</a></li></ul></div></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">Fun with Prolog: Priceonomics Puzzle</h1><div class="mb-md-4 meta"><span class="date middot" title="Fri Jun 7 2013 00:00:00 UTC">2013-06-07</span>
<span class="reading-time middot">4 min read</span><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class="d-inline middot"><a href=/tags/prolog>prolog</a></li><li class="d-inline middot"><a href=/tags/code>code</a></li></ul></div><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"></ul></div></div><div class="markdown blog-post-content"><p>The <a href=http://blog.priceonomics.com/ target=_blank>Priceonomics blog</a> is one of my favorites so when I saw that they had a <a href=http://priceonomics.com/jobs/puzzle/ target=_blank>programming puzzle</a> up I decided to have some fun with it. And what’s more fun than hacking around with a quirky, esoteric programming language? I remember having fond memories of playing around with Prolog in middle school so decided to dig it up again in an attempt to solve this puzzle.</p><p>Prolog is pretty different than the mainstream programming languages, it belongs to the logic programming language category and relies on defining a variety of relations and then querying these relationships to get results. A simplified way to think about it is you define a set of equations and tell Prolog to &ldquo;solve for X&rdquo;.</p><p>This leads to some interesting behavior. Many functions end up being bidrectional with the Prolog version of a &ldquo;concat&rdquo; function being a good example. The first argument is a list, the second is the separator, and the last is the resulting string. Passing in all 3 will return true if the concatenation statement is true. Passing in the list and the separator will tell us what the concatenated string is. Passing in the separator and a concatenated string is equivalent to a &ldquo;split&rdquo; function. The only piece it&rsquo;s not able to figure out is the separator given the list and the concatenated string. Unfortunately, I&rsquo;m not familiar enough with Prolog to explain why.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-prolog data-lang=prolog><span style=color:#e6db74>?-</span> <span style=color:#a6e22e>atomic_list_concat</span>([<span style=color:#e6db74>&#39;Prolog&#39;</span>, <span style=color:#e6db74>&#39;is&#39;</span>, <span style=color:#e6db74>&#39;sweet&#39;</span>], <span style=color:#e6db74>&#39; &#39;</span>, <span style=color:#e6db74>&#39;Prolog is sweet&#39;</span>).
<span style=color:#e6db74>true</span>.

<span style=color:#e6db74>?-</span> <span style=color:#a6e22e>atomic_list_concat</span>([<span style=color:#e6db74>&#39;Prolog&#39;</span>, <span style=color:#e6db74>&#39;is&#39;</span>, <span style=color:#e6db74>&#39;sweet&#39;</span>], <span style=color:#e6db74>&#39; &#39;</span>, <span style=color:#e6db74>&#39;Prolog is not sweet&#39;</span>).
<span style=color:#e6db74>false</span>.

<span style=color:#e6db74>?-</span> <span style=color:#a6e22e>atomic_list_concat</span>([<span style=color:#e6db74>&#39;Prolog&#39;</span>, <span style=color:#e6db74>&#39;is&#39;</span>, <span style=color:#e6db74>&#39;sweet&#39;</span>], <span style=color:#e6db74>&#39; &#39;</span>, X).
X <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Prolog is sweet&#39;</span>.

<span style=color:#e6db74>?-</span> <span style=color:#a6e22e>atomic_list_concat</span>(L, <span style=color:#e6db74>&#39; &#39;</span>, <span style=color:#e6db74>&#39;Prolog is sweet&#39;</span>).
L <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Prolog&#39;</span>, <span style=color:#f92672>is</span>, <span style=color:#e6db74>sweet</span>].

<span style=color:#e6db74>?-</span> <span style=color:#a6e22e>atomic_list_concat</span>([<span style=color:#e6db74>&#39;Prolog&#39;</span>, <span style=color:#f92672>is</span>, <span style=color:#e6db74>sweet</span>], X, <span style=color:#e6db74>&#39;Prolog is sweet&#39;</span>).
ERROR<span style=color:#e6db74>:</span> <span style=color:#e6db74>atomic_list_concat</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span><span style=color:#e6db74>:</span> Arguments <span style=color:#e6db74>are</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>sufficiently</span> <span style=color:#e6db74>instantiated</span></code></pre></div><p>For the first pass, I decided to ignore the web side and just focus on defining the exchange rate relationships and have Prolog tell me which exchanges would work. The way it works is that we define a profit to be defined in terms of two intermediate currencies. We can then ask Prolog to give us the currency chain that will result in a profit.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-prolog data-lang=prolog><span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>usd</span>,<span style=color:#e6db74>eur</span>,<span style=color:#ae81ff>0.7779</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>usd</span>,<span style=color:#e6db74>jpy</span>,<span style=color:#ae81ff>102.459</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>usd</span>,<span style=color:#e6db74>btc</span>,<span style=color:#ae81ff>0.0083</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>eur</span>,<span style=color:#e6db74>usd</span>,<span style=color:#ae81ff>1.2851</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>eur</span>,<span style=color:#e6db74>jpy</span>,<span style=color:#ae81ff>131.711</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>eur</span>,<span style=color:#e6db74>btc</span>,<span style=color:#ae81ff>0.01125</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>jpy</span>,<span style=color:#e6db74>usd</span>,<span style=color:#ae81ff>0.0098</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>jpy</span>,<span style=color:#e6db74>eur</span>,<span style=color:#ae81ff>0.0075</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>jpy</span>,<span style=color:#e6db74>btc</span>,<span style=color:#ae81ff>0.0000811</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>btc</span>,<span style=color:#e6db74>usd</span>,<span style=color:#ae81ff>115.65</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>btc</span>,<span style=color:#e6db74>eur</span>,<span style=color:#ae81ff>88.8499</span>).
<span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>btc</span>,<span style=color:#e6db74>jpy</span>,<span style=color:#ae81ff>12325.44</span>).

<span style=color:#75715e>% Calculate profit for a usd-&gt;x-&gt;y-&gt;usd currency chain</span>
<span style=color:#a6e22e>profit</span>(First, Second, Profit) :-
    <span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>usd</span>,First,P1),
    <span style=color:#a6e22e>exchange</span>(First,Second,P2),
    <span style=color:#a6e22e>exchange</span>(Second,<span style=color:#e6db74>usd</span>,P3),
    Profit <span style=color:#f92672>is</span> P1 <span style=color:#f92672>*</span> P2 <span style=color:#f92672>*</span> P3.

<span style=color:#a6e22e>arb</span> <span style=color:#f92672>:-</span>
    <span style=color:#a6e22e>profit</span>(First, Second, Profit),
    Profit <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1.0</span>,
    <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39;usd &#39;</span>),
    <span style=color:#a6e22e>write</span>(First), <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39; &#39;</span>),
    <span style=color:#a6e22e>write</span>(Second), <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39; usd &#39;</span>),
    <span style=color:#a6e22e>write</span>(Profit), <span style=color:#e6db74>nl</span>, <span style=color:#e6db74>fail</span>.

:- <span style=color:#e6db74>arb</span>.

<span style=color:#75715e>% Results:</span>
<span style=color:#e6db74>usd</span> <span style=color:#e6db74>eur</span> <span style=color:#e6db74>jpy</span> <span style=color:#e6db74>usd</span> <span style=color:#ae81ff>1.0040882716200001</span>
<span style=color:#e6db74>usd</span> <span style=color:#e6db74>eur</span> <span style=color:#e6db74>btc</span> <span style=color:#e6db74>usd</span> <span style=color:#ae81ff>1.0120965187500002</span>
<span style=color:#e6db74>usd</span> <span style=color:#e6db74>btc</span> <span style=color:#e6db74>jpy</span> <span style=color:#e6db74>usd</span> <span style=color:#ae81ff>1.0025512896</span></code></pre></div><p>The next step was to get it to retrieve and parse the JSON from the Priceonomics server. After doing a ton of searches and reading a ton of documentation I was able to get it to work. As a next step I&rsquo;ll try to see if I can get it to return currency chains of arbitrary length.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-prolog data-lang=prolog>:- <span style=color:#a6e22e>use_module</span>(<span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#39;http/json&#39;</span>)).
:- <span style=color:#a6e22e>use_module</span>(<span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#39;http/json_convert&#39;</span>)).
:- <span style=color:#a6e22e>use_module</span>(<span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#39;http/http_json&#39;</span>)).
:- <span style=color:#a6e22e>use_module</span>(<span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#39;http/http_client&#39;</span>)).
:- <span style=color:#a6e22e>use_module</span>(<span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#39;http/http_open&#39;</span>)).

<span style=color:#a6e22e>parse</span>(I) :-
    <span style=color:#a6e22e>test</span>(CP<span style=color:#f92672>=</span>S) <span style=color:#f92672>=</span> <span style=color:#a6e22e>test</span>(I),
    <span style=color:#a6e22e>atomic_list_concat</span>(L,<span style=color:#e6db74>&#39;_&#39;</span>, CP),
    [A, B] <span style=color:#f92672>=</span> L,
    <span style=color:#a6e22e>atom_number</span>(S,R),
    <span style=color:#a6e22e>assert</span>(<span style=color:#a6e22e>exchange</span>(A,B,R)).

<span style=color:#75715e>% Calculate profit for a usd-&gt;x-&gt;y-&gt;usd currency chain</span>
<span style=color:#a6e22e>profit</span>(First, Second, Profit) :-
    <span style=color:#a6e22e>exchange</span>(<span style=color:#e6db74>&#39;USD&#39;</span>,First,P1),
    <span style=color:#a6e22e>exchange</span>(First,Second,P2),
    <span style=color:#a6e22e>exchange</span>(Second,<span style=color:#e6db74>&#39;USD&#39;</span>,P3),
    Profit <span style=color:#f92672>is</span> P1 <span style=color:#f92672>*</span> P2 <span style=color:#f92672>*</span> P3.

<span style=color:#a6e22e>arb</span> <span style=color:#f92672>:-</span>
    <span style=color:#a6e22e>http_get</span>(<span style=color:#e6db74>&#39;http://fx.priceonomics.com/v1/rates/&#39;</span>, JsonIn, []),
    <span style=color:#a6e22e>json_to_prolog</span>(JsonIn,PrologIn),
    PrologIn <span style=color:#f92672>=</span> <span style=color:#a6e22e>json</span>(L),
    <span style=color:#a6e22e>maplist</span>(<span style=color:#e6db74>parse</span>, L),
    <span style=color:#a6e22e>profit</span>(First, Second, Profit),
    Profit <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1.0</span>,
    <span style=color:#f92672>not</span>(First <span style=color:#f92672>=</span> Second),
    <span style=color:#f92672>not</span>(First <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;USD&#39;</span>),
    <span style=color:#f92672>not</span>(Second <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;USD&#39;</span>),
    <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39;USD &#39;</span>),
    <span style=color:#a6e22e>write</span>(First), <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39; &#39;</span>),
    <span style=color:#a6e22e>write</span>(Second), <span style=color:#a6e22e>write</span>(<span style=color:#e6db74>&#39; USD &#39;</span>),
    <span style=color:#a6e22e>write</span>(Profit), <span style=color:#e6db74>nl</span>, <span style=color:#e6db74>fail</span>.

:- <span style=color:#e6db74>arb</span>.

<span style=color:#75715e>% Results (Might change each run):</span>
USD JPY EUR USD <span style=color:#ae81ff>1.0071833283714342</span>
USD EUR JPY USD <span style=color:#ae81ff>1.007164983424893</span></code></pre></div><p>I&rsquo;m sure a Prolog pro would have been able to do this much quicker and better but I had a surprisingly fun time doing it. I got a bit frustrated trying to translate the JSON into Prolog relationships but actually getting it to work made it worth it. Trying a whole new programming category is a great way to get more creative and forces us to think about problems differently. Prolog may not be the most practical language but exposing us to new concepts and approaches makes it valuable.</p></div><div class=navigation><div class=row><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-left"><a href=/2013/06/04/citibike-directions-second-attempt/>« Citibike Directions: Second Attempt</a></div></div><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-right"><a href=/2013/06/12/constantly-entertained/>Constantly entertained »</a></div></div></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><div class="my-4 footer"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><hr></div></div><div class="row justify-content-center"><div class="col-sm-12 col-lg-2"><div class="mx-0 mx-md-4 site-copyright">© 2021 Dan Goldin</div></div><div class="col-sm-12 col-lg-6"><div class="mx-0 mx-md-4 site-social"><ul><li><a href=mailto:dan@dangoldin.com>Contact</a></li><li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li><li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li><li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li><li><a href=/index.xml class=mr-0>RSS</a></li></ul></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script>window.addEventListener('load',function(){hljs.initHighlighting();},true);</script></body></html>