<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>My personal Grafana dashboard - Dan Goldin</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="In order to measure my performance against my 2020 blogging goals I set up a simple Grafana dashboard powered by MySQL"><meta property="og:site_name" content="Dan Goldin"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="/2020/02/27/my-personal-grafana-dashboard/"><meta property="og:title" content="My personal Grafana dashboard"><meta property="og:image" content="//image/personal-grafana-dashboard-blog-stats.png"><meta property="og:description" content="In order to measure my performance against my 2020 blogging goals I set up a simple Grafana dashboard powered by MySQL"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dangoldin"><meta name=twitter:creator content="@dangoldin"><meta name=twitter:title content="My personal Grafana dashboard"><meta name=twitter:description content="In order to measure my performance against my 2020 blogging goals I set up a simple Grafana dashboard powered by MySQL"><meta name=twitter:image content="//image/personal-grafana-dashboard-blog-stats.png"><link rel=canonical href=/2020/02/27/my-personal-grafana-dashboard/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://nanx-assets.netlify.app/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=image/favicon.png><link href=/index.xml rel=alternate type=application/rss+xml title="Dan Goldin"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-36313127-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-36313127-1');</script></head><body><div class="my-4 my-lg-5 header"><div class=container><div class=row><div class="col-auto offset-lg-2 d-none d-lg-block"><a href=/><img class="ml-lg-4 logo img-fluid d-block rounded-circle" src=/image/photo.jpg alt=logo></a></div><div class="col-auto align-self-center mr-auto"><a href=/><h1 class=name>Dan Goldin</h1></a><ul class="nav nav-primary"><li class=nav-item><a class="nav-link text-home" href=/>Home</a></li><li class=nav-item><a class="nav-link text-about" href=/about/>About</a></li><li class=nav-item><a class="nav-link text-lore" href=/lore/>Lore</a></li></ul></div></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">My personal Grafana dashboard</h1><div class="mb-md-4 meta"><span class="date middot" title="Thu Feb 27 2020 00:00:00 UTC">2020-02-27</span>
<span class="reading-time middot">4 min read</span><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class="d-inline middot"><a href=/tags/code>code</a></li><li class="d-inline middot"><a href=/tags/dataviz>dataviz</a></li></ul></div><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"></ul></div></div><div class="markdown blog-post-content"><p><img src=/image/personal-grafana-dashboard-blog-stats.png alt="My personal Grafana dashboard for blog stats" data-width=1913 data-height=978 data-layout=responsive></p><p>Last year I wrote about the idea of a <a href=/2019/07/10/personal-dashboards/>personal dashboard</a> and earlier this year I described my <a href=/2020/01/28/2020-goals/>2020 goals</a> and how I&rsquo;d go about measuring my progress. The past two days I was able to combine the two concepts and created a simple Grafana dashboard to measure my progress against the blogging goal. As with most tasks, the most difficult part was getting started and the actual exercise took a few hours. While it&rsquo;s still fresh in my mind I want to document the step by step process in order to both provide a perspective into how I work while also giving others a guide to setting up their own.</p><ul><li><strong>Decide on the Grafana backend</strong>. I already committed to Grafana as the visualization layer but needed to decide on the actual statistics backend. This isn&rsquo;t that important of a decision and I can change it any time so I just chose MySQL. I have a personal instance of MySQL floating around (who doesn&rsquo;t?), am not going to be dumping much data into it, and am comfortable writing SQL queries.</li><li><strong>Set up MySQL</strong>. I already had a MySQL instance up so this required setting up a new database and the appropriate users. Note that I needed to create a master user for adding the data as well as a read-only user that Grafana uses for querying.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;stats_user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;XYZ&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span>,<span style=color:#66d9ef>INSERT</span>,<span style=color:#66d9ef>UPDATE</span>,<span style=color:#66d9ef>DELETE</span>,<span style=color:#66d9ef>CREATE</span>,<span style=color:#66d9ef>DROP</span>,<span style=color:#66d9ef>ALTER</span>,<span style=color:#66d9ef>INDEX</span>,<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TEMPORARY</span> TABLES,<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>VIEW</span>,<span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>VIEW</span> <span style=color:#66d9ef>ON</span> stats.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;stats_user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>;

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;stats_read&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;ABC&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> stats.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;stats_read&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>;</code></pre></div></li><li><strong>Determine the MySQL schema</strong>. Since I know both the unit I want to analyze (blog post) and the metric I care about the schema practically writes itself. At first I chose date, title, and a few of the fields but tweaked this after the subsequent step.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> blog_post (
    ymd date <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    slug varchar(<span style=color:#ae81ff>200</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    title varchar(<span style=color:#ae81ff>200</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    keywords varchar(<span style=color:#ae81ff>1000</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    description varchar(<span style=color:#ae81ff>1000</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    tags varchar(<span style=color:#ae81ff>200</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_chars int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_text_words int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_text_description int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_keywords int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_tags int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_images int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    num_links int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    <span style=color:#66d9ef>unique</span> <span style=color:#66d9ef>key</span> (ymd, slug)
);</code></pre></div></li><li><strong>Get the data into MySQL</strong>. Lucky for me I already had an old <a href=https://github.com/dangoldin/blog-analytics>blog analysis script</a> that took my blog, cleaned up all the posts, and dumped the contents to a CSV. I had to make a few tweaks to the script to allow me to specify the exact fields to write out but after that was done I had a CSV file that could be imported to MySQL. I had a few options for how to get this data into MySQL including modifying the above script to connect to MySQL but instead decided that using a manual <code>LOAD DATA</code> command would suffice for now. Out of all the steps this one took the longest time - especially figuring out the right syntax for the <code>LOAD DATA</code> command.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>LOAD</span> <span style=color:#66d9ef>DATA</span> <span style=color:#66d9ef>LOCAL</span> INFILE <span style=color:#e6db74>&#39;/home/dan/code/blog-analytics/out.csv&#39;</span>
  <span style=color:#66d9ef>REPLACE</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>TABLE</span> blog_post
    FIELDS TERMINATED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;,&#39;</span> ENCLOSED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;&#34;&#39;</span> ESCAPED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;&#34;&#39;</span>
    LINES TERMINATED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;\n&#39;</span>
    <span style=color:#66d9ef>IGNORE</span> <span style=color:#ae81ff>1</span> LINES
    (title,tags,keywords,description,num_chars,num_text_words,num_text_description,num_keywords,num_tags,num_images,num_links,ymd,slug);</code></pre></div></li><li><strong>Connect Grafana to MySQL</strong>. Grafana worked right out of the box after installation with <code>apt get</code> but I had to create a read-only user as Grafana refused to use a user that had write access.</li><li><strong>Create a few dashboards</strong>. Now came the fun part. I started by trying to use Grafana&rsquo;s query builder took but quickly resorted to just writing the SQL manually. The nuance here was having to convert the MySQL date field into a UNIX timestamp that worked with Grafana.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span>
  UNIX_TIMESTAMP(ymd) <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;time&#34;</span>,
  num_chars
<span style=color:#66d9ef>FROM</span> blog_post
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> UNIX_TIMESTAMP(ymd);

<span style=color:#66d9ef>SELECT</span>
  UNIX_TIMESTAMP(date_format(ymd, <span style=color:#e6db74>&#39;%Y-%m-01&#39;</span>)) <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;time&#34;</span>,
  <span style=color:#66d9ef>avg</span>(num_chars) <span style=color:#66d9ef>as</span> average_monthly_chars
<span style=color:#66d9ef>FROM</span> blog_post
<span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> time
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> time</code></pre></div></li><li><strong>Clean up the deployment</strong>. By default, Grafana runs on port 3000 and I wanted to serve it on a standard port behind HTTPS. This required installing nginx (via <code>apt get</code>), using it to create a simple reverse proxy, and then using <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> to add SSL. At this point I also gave this a unique Grafana subdomain.<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>server</span> {

	<span style=color:#f92672>server_name</span> <span style=color:#e6db74>xyz.abc</span>;

	<span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
		 <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://localhost:3000/</span>;
	}

    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>ipv6only=on</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/letsencrypt/live/xyz.abc/fullchain.pem</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/letsencrypt/live/xyz.abc/privkey.pem</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    <span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/letsencrypt/options-ssl-nginx.conf</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_dhparam</span> <span style=color:#e6db74>/etc/letsencrypt/ssl-dhparams.pem</span>; <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>}</code></pre></div></li></ul><p>The solution is far from perfect - for example if the instance hosting Grafana goes down I&rsquo;d have to repeat the bulk of the above steps. At the same time, that&rsquo;s a risk I&rsquo;m currently willing to take, especially since the process itself was so quick and I&rsquo;m manually saving down the JSON behind the dashboard.</p></div><div class=navigation><div class=row><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-left"><a href=/2020/02/11/embracing-smartphone-productivity/>« Embracing smartphone productivity</a></div></div><div class="col-12 col-lg-6"><div class="mx-0 mx-md-4 mt-4 text-right"><a href=/2020/03/01/paying-for-improved-productivity/>Paying for improved productivity »</a></div></div></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo=dangoldin/blog.dangoldin.com-comments issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><div class="my-4 footer"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><hr></div></div><div class="row justify-content-center"><div class="col-sm-12 col-lg-2"><div class="mx-0 mx-md-4 site-copyright">© 2021 Dan Goldin</div></div><div class="col-sm-12 col-lg-6"><div class="mx-0 mx-md-4 site-social"><ul><li><a href=mailto:dan@dangoldin.com>Contact</a></li><li><a href=https://github.com/dangoldin target=_blank>GitHub</a></li><li><a href=https://twitter.com/dangoldin target=_blank>Twitter</a></li><li><a href=https://www.linkedin.com/in/dangoldin target=_blank>LinkedIn</a></li><li><a href=/index.xml class=mr-0>RSS</a></li></ul></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script>window.addEventListener('load',function(){hljs.initHighlighting();},true);</script><script src=/js/math-code.js></script><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>